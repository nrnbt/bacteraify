{% load static %}
{% if surveys %}
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.3.2/html2canvas.min.js"></script>
  <script src="{% static 'js/download-survey-result.js' %}"></script>

  <table class="table table-striped w-full">
  <thead>
    <tr>
      <th scope="col" class="bg-primary text-white text-center">#</th>
      <th scope="col" class="bg-primary text-white text-center">Шинжилгээний дугаар</th>
      <th scope="col" class="bg-primary text-white text-center">Сорьцын тоо</th>
      <th scope="col" class="bg-primary text-white text-center">Алгоритм</th>
      <th scope="col" class="bg-primary text-white text-center">Байршуулсан файл</th>
      <th scope="col" class="bg-primary text-white text-center">Шинжилгээний хариу</th>
      <th scope="col" class="bg-primary text-white text-center">Үүсгэсэн огноо</th>
    </tr>
  </thead>
  <tbody>
    {% for survey in surveys %}
      <tr>
        <th class="text-center text-dark align-middle" scope="row">
          {{ forloop.counter0|add:surveys.start_index }}
        </th>
        <td class="text-center text-dark align-middle">
          <a href="{% url 'survey-result' %}?id={{ survey.id|urlencode }}">{{ survey.surveyNumber }}</a>
        </td>
        <td class="text-center text-dark align-middle">{{ survey.rowNumber }}</td>
        <td class="text-center text-dark align-middle">{{ survey.modelTypes }}</td>
        <td class="text-center text-dark align-middle">
          {% if survey.surveyFileName %}
            <button class="btn btn-link mb-0 px-0 ms-4">
              <a class="text-dark" href="#" onclick="downloadFile('{% url 'download-survey' %}?survey={{ survey.surveyFileName|urlencode }}')">
                <i class="fas fa-file-csv text-lg me-1"></i>CSV
              </a>
            </button>
          {% else %}
              <div>=</div>
          {% endif %}
        </td>
        <td class="text-center text-dark align-middle">
          {% if survey.cnnPredFileName or survey.svmPredFileName or survey.rnnPredFileName %}
            <button id="loadingButton"  class="btn btn-link mb-0 px-0 ms-4" onclick="downloadPdf('{{ survey.id|urlencode }}')">
              <a class="text-dark"  href="#">
                <i class="fas fa-file-pdf text-lg me-1"></i>PDF
              </a>
            </button>
          {% else %}
            <div>=</div>
          {% endif %}
        </td>
        <td class="text-center text-dark align-middle">{{ survey.created_at|date:"Y-m-d h:i:s" }}</td>
      </tr>
    {% endfor %}
  </tbody>
</table>

<nav class="container">
  <ul class="pagination justify-center">
    {% if surveys.has_previous %}
    <li class="page-item">
      <a class="page-link" href="?page=1">
        <i class="fa-solid fa-angles-left"></i>
      </a>
    </li>
      <li class="page-item">
        <a class="page-link" href="?page={{ surveys.previous_page_number }}">
          <i class="fa-solid fa-chevron-left"></i>
        </a>
      </li>
    {% endif %}

    {% for i in surveys.paginator.page_range %}
      <li class="page-item">
        <a class="page-link {% if surveys.number == i %} active {% endif %}" href="?page={{ i }}">
          {{ i }}
        </a>
      </li>
    {% endfor %}
    {% if surveys.has_next %}
    <li class="page-link">
      <a href="?page={{ surveys.next_page_number }}">
        <i class="fa-solid fa-chevron-right"></i>
      </a>
    </li>
    <li class="page-link">
      <a href="?page={{ surveys.paginator.num_pages }}">
        <i class="fa-solid fa-angles-right"></i>
      </a>
    </li>
  {% endif %}
  </ul>
</nav>

<div id="hiddenContainer" style="width: 100%"></div>
{% else %}
<div class="flex flex-col w-full justify-center">
  <img class="empty-img" src="{% static 'images/icon-images/empty.png' %}" alt="empty">
  <div class="text-center">
    <h2>Шинжилгээ хоосон байна</h2>
  </div>
</div>
{% endif %}