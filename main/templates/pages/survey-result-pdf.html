{% load static %}

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.3.2/html2canvas.min.js"></script>
<script src="{% static 'js/download-survey-result.js' %}"></script>

<div style="position: relative;">
  <div style="display: flex; flex-direction: column; justify-content: center; align-items: center;">
    <img src="data:image/png;base64,{{ logo_img_data|safe }}" alt="bacteraify-logo">
    <h2 class="text-center">BACTERAIFY ЛАБОРАТОРИ</h2>
    <h2 class="text-center">ХАЯГ: БАЯНЗҮРХ ДҮҮРЭГ, ШИНЭ МОНГОЛ ТЕХНОЛОГИЙН ДЭЭД СУРГУУЛЬ</h2>
    <h2 class="text-center">УТАС:(+976)99172098, ВЕБ: WWW.BACTERAIFY.MN</h2>
  </div>
</div>

<div style="height: 2px; background-color: #000; margin-top: 40px; margin-bottom: 40px;"></div>

<div class="flex flex-col w-full items-start" style="margin-bottom: 40px;">
  <div id="survey_number">
    <strong>ШИНЖИЛГЭЭНИЙ ДУГААР:</strong> {{ number|safe }}
  </div>
  <div id="created_at">
    <strong>ШИНЖИЛГЭЭ ӨГСӨН ОГНОО:</strong> {{ created_at|safe }}
  </div>
  <div id="downloaded_at"></div>
</div>

<div class="flex flex-col justify-center" style="padding-right: 5px; padding-left: 5px; margin-bottom: 40px; width: 100%;">
  <table class="table table-striped w-full">
    <thead>
      <tr>
        {% if not result_data|length == 1 %}
          <th style="vertical-align: middle" scope="col" class="bg-primary text-white text-center">#</th>
        {% endif %}
        <th style="vertical-align: middle" scope="col" class="bg-primary text-white text-center">Бактери нэршил</th>
        {% for model_type in model_types %}
          <th style="vertical-align: middle" scope="col" class="bg-primary text-white text-center">Илэрсэн хувь {{ model_type }}</th>
        {% endfor %}
      </tr>
    </thead>
    <tbody>
      {% for item in result_data %}
        {% for bacteria in item.data %}
          <tr>
            {% if not result_data|length == 1 %}
              <td class="text-center">
                <div class="d-flex justify-content-center gap-2 align-items-center" style="height: 45px">
                  {{ item.row }}
                </div>
              </td>
            {% endif %}
            <td class="text-center">
              <div class="d-flex justify-content-center gap-2 align-items-center">
                {{ bacteria.bacteria }}
                <img style="height: 45px; object-fit: contain;" src="{% static 'images/bacteria/' %}{{bacteria.bacteria}}.png" alt="{{ bacteria.bacteria }}">
              </div>
            </td>
            {% if 'CNN' in model_types  %}
              <td class="text-center">
                <div class="d-flex justify-content-center gap-2 align-items-center" style="height: 45px">{{ bacteria.CNN }}</div>
              </td>
            {% endif %}
            {% if 'SVM' in model_types  %}
              <td class="text-center">
                <div class="d-flex justify-content-center gap-2 align-items-center" style="height: 45px">{{ bacteria.SVM }}</div>
              </td>
            {% endif %}
            {% if 'RNN' in model_types  %}
              <td class="text-center">
                <div class="d-flex justify-content-center gap-2 align-items-center" style="height: 45px">{{ bacteria.RNN }}</div>
              </td>
            {% endif %}
          </tr>
        {% endfor %}
      {% endfor %}
    </tbody>
  </table>
  <i class="w-full text-center">Бактери илрүүлсэн харьцаа</i>
</div>

{% for bacteria_spectrum in bacteria_images %}
<div class="flex flex-col w-full justify-center" style="margin-bottom: 20px;">
  <img style="width: 100%; height: 100%; object-fit: contain;" src="data:image/png;base64,{{ bacteria_spectrum.img_data|safe }}" alt="Bacteria Graph Image">
  <i class="w-full text-center">"{{ bacteria_spectrum.bacteria }}" бактерийн раман спектрум харьцуулалт</i>
</div>
{% endfor %}
